<header>
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="collapsibleNavbar">
                <a class="navbar-brand" href="#" routerLink="home">
                    <img class="rounded-pill" src="../../../../images/logo.png" alt="Logo de aplicacion de libros" />
                </a>
                <ul class="navbar-nav d-flex justify-content-end align-items-end flex-grow-1">
                    <li class="nav-item ms-3">
                        <a class="nav-link" routerLink="/books" routerLinkActive="active">
                            <i class="bi bi-book-fill me-1"></i>
                            Libros
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" routerLink="/historial" routerLinkActive="active">
                            <i class="bi bi-record"></i>
                            Historial</a>
                    </li>

                    <li class="nav-item ms-3">
                        <a class="nav-link" routerLink="/books-user" routerLinkActive="active">
                            <i class="bi bi-list-task me-1"></i>
                            Mis Encargos
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" routerLink="/contact" routerLinkActive="active">
                            <i class="bi bi-telephone me-1"></i>
                            Contacto
                        </a>
                    </li>
                </ul>
                <div class="dropdown">
                    <button class="btn dropdown-toggle profile-button" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <img src="images/perfil.jpg" alt="Foto por defecto" class="profile-image" width="120"
                            height="150">
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" routerLink="/show-profile">
                                <i class="bi bi-person-fill me-1"></i>
                                Perfil</a>
                        </li>
                        <li><a class="dropdown-item" routerLink="/edit-profile">
                                <i class="bi bi-pencil-square me-1"></i> Editar perfil</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" (click)="onLogout()">
                                <i class="bi bi-box-arrow-right me-1"></i>
                                Cerrar sesión
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="cart-container position-relative">
                    <button class="cart-button" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart"
                        aria-controls="offcanvasCart" data-bs-backdrop="false">
                        <i class="bi bi-cart fs-3"></i>
                        @if (totalBooks > 0) {
                        <span class="cart-badge">{{totalBooks}}</span>
                        }
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasCart" aria-labelledby="offcanvasCartLabel">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title p-2" id="offcanvasCartLabel">
                <i class="bi bi-cart me-2"></i> Mi Cesta
            </h5>
            <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
        </div>


        <div class="offcanvas-body d-flex flex-column">
            <div class="cart-content flex-grow-1">
                @if (books.length > 0){
                <ul class="list-group">
                    @for (book of books; track book; let i = $index;) {
                    <li class="list-group-item">
                        <div class="d-flex align-items-center gap-4 mb-2 mt-2">
                            <img [src]="book.imagen" alt="{{ book.titulo }}" class="img-thumbnail">
                            <div class="container-shop">
                                <h3 class="shop-title">{{ book.titulo }}</h3>
                                <br>
                                <p class="shop-autor">{{ book.autor }}</p>
                            </div>
                        </div>
                        <div class="count-container mt-2">
                            <div class="d-flex flex-row align-items-center gap-2">
                                <button class="btn btn-outline-secondary" (click)="validateNumBooks(book, 1)">
                                    <i class="bi bi-dash"></i>
                                </button>
                                <p class="m-0">{{ book.count }}</p>
                                <button class="btn btn-outline-secondary" (click)="validateNumBooks(book, 2)">
                                    <i class="bi bi-plus"></i>
                                </button>
                            </div>

                            <div class="container-price">
                                <h3>{{ (book.precio * book.count).toFixed(2) }} €</h3>
                            </div>

                            <div class="container-delete">
                                <button (click)="deleteBookShop(book.id)">
                                    <i class="bi bi-trash3"></i>
                                </button>
                            </div>
                        </div>
                    </li>
                    }
                </ul>
                } @else {
                <div class="container-none">
                    <h2>
                        <i class="bi bi-exclamation-circle-fill me-2"></i>
                        No hay artículos en la cesta
                    </h2>
                </div>
                }
            </div>

            <div class="cart-summary mt-3">
                <div class="summary-details">
                    <p class="summary-text mb-3">Subtotal</p>
                    <p class="summary-value">{{ subtotal.toFixed(2) }} €</p>
                </div>

                <div class="summary-details">
                    <p class="summary-text">Total Productos</p>
                    <p class="summary-value">{{totalBooks}}</p>
                </div>
                <div class="summary-total">
                    <p class="total-text">Precio Total:</p>
                    <p class="total-value">{{totalPrice}} €</p>
                </div>
                <button class="checkout-button" (click)="onConfirmBooking()">Finalizar reserva</button>
            </div>
        </div>
        <app-modal-confirm-booking [userData]="userData" [books]="books" [modal]="modal"
            (closeModal)="onClose()"></app-modal-confirm-booking>
    </div>
    <app-search-bar></app-search-bar>
</header>