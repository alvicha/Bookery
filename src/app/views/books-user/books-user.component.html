<section class="books-user-section">
    <div class="container">
        <h2 class="title-book">DATOS ENCARGOS</h2>

        <div class="container-tabs">
            <div class="login-tabs">
                @for (tab of tabs; track tab; let i = $index;) {
                <button [ngClass]="activeTab === tab.value ? 'tab active' : 'tab'" (click)="activeTab = tab.value">
                    <i [class]="tab.icon" class="mx-1"></i>
                    {{tab.label}}
                </button>
                }
            </div>
        </div>

        <div class="tab-content mt-4">
            @if (activeTab === 0){
            <div class="total-products mt-4">
                <h3>Total productos comprados: {{booksUser.length}}</h3>
            </div>

            @if (booksUser.length > 0){
            <div class="p-4 mb-5 border-none">
                <p-carousel [value]="booksUser" [numVisible]="booksUser.length" [numScroll]="1" [circular]="true"
                    [responsiveOptions]="responsiveOptions" autoplayInterval="3000">
                    <ng-template pTemplate="item" let-book>
                        <div class="px-5">
                            <div class="body-carousel" (click)="onShowBookSelected(book.id)">
                                <div class="image-container">
                                    <img [src]="book.imagen" [alt]="book.titulo" />
                                </div>
                                <div class="book-title">{{ book.titulo }}</div>
                                <div class="book-autor">{{ book.autor }}</div>
                                <div class="book-anyo">{{ book.idioma }}</div>
                            </div>
                        </div>
                    </ng-template>
                </p-carousel>
            </div>
            } @else {
            <div class="message-books">
                <h3>
                    <i class="bi bi-dash-circle-fill me-1"></i>
                    No hay libros comprados.
                </h3>
                <p>Cuando agregues libros aparecerán aquí.</p>
            </div>
            }
            } @else if(activeTab === 1) {
            <div class="table-container">
                <p-table [value]="bookings" stripedRows showGridlines [paginator]="true" [rows]="5"
                    [tableStyle]="{ 'min-width': '60rem', 'max-height': '50rem' }" [rowsPerPageOptions]="[5, 10, 20]"
                    sortField="price" [sortOrder]="-1">

                    <ng-template #caption>
                        <div class="container-caption">
                            <span class="fw-bold text-underline">Mis reservas</span>
                            <p-button icon="pi pi-refresh" [rounded]="true" [raised]="true"></p-button>
                        </div>
                    </ng-template>

                    <ng-template #header>
                        <tr>
                            <th pSortableColumn="id">
                                <div class="flex items-center gap-2">
                                    Id
                                    <p-sortIcon field="id" />
                                </div>
                            </th>
                            <th pSortableColumn="fecha">
                                <div class="flex items-center gap-2">
                                    Fecha
                                    <p-sortIcon field="fecha" />
                                </div>
                            </th>
                            <th pSortableColumn="hora">
                                <div class="flex items-center gap-2">
                                    Hora
                                    <p-sortIcon field="hora" />
                                </div>
                            </th>
                            <th pSortableColumn="estado">
                                <div class="flex items-center gap-2">
                                    Estado
                                    <p-sortIcon field="estado" />
                                </div>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template #body let-booking>
                        <tr>
                            <td>{{ booking.id }}</td>
                            <td>{{ booking.fechaString }}</td>
                            <td>{{ booking.hora }}</td>
                            <td>
                                <p-tag [value]="booking.estado" [severity]="getSeverity(booking.estado)" />
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template #footer>
                        <tr>
                            <td colspan="6">En total hay {{ bookings ? bookings.length : 0 }} reservas.</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
            } @else if(activeTab === 2) {
            @if (favouriteBooks.length > 0){
            <div class="p-5 mb-5 border-none">
                <p-carousel [value]="favouriteBooks" [numVisible]="favouriteBooks.length" [circular]="true" [numScroll]="1"
                    [responsiveOptions]="responsiveOptions" autoplayInterval="3000">
                    <ng-template pTemplate="item" let-book>
                        <div class="px-5">
                            <div class="body-carousel" (click)="onShowBookSelected(book.id)">
                                <div class="image-container">
                                    <img [src]="book.imagen" [alt]="book.titulo" />
                                </div>
                                <div class="book-title">{{ book.titulo }}</div>
                                <div class="book-autor">{{ book.autor }}</div>
                                <div class="book-anyo">{{ book.idioma }}</div>
                            </div>
                        </div>
                    </ng-template>
                </p-carousel>
            </div>
            } @else {
            <div class="message-books">
                <h3>
                    <i class="bi bi-dash-circle-fill me-1"></i>
                    No hay libros favoritos.
                </h3>
            </div>
            }
            }
        </div>
    </div>
</section>